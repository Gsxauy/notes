<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Js - Promise</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.26cac436.js" as="script"><link rel="preload" href="/assets/js/2.2df5d1b6.js" as="script"><link rel="preload" href="/assets/js/20.4bd18993.js" as="script"><link rel="prefetch" href="/assets/js/10.eaa1d4ec.js"><link rel="prefetch" href="/assets/js/11.6f95e229.js"><link rel="prefetch" href="/assets/js/12.30eddc72.js"><link rel="prefetch" href="/assets/js/13.4fdf441e.js"><link rel="prefetch" href="/assets/js/14.ac967237.js"><link rel="prefetch" href="/assets/js/15.ab0fe770.js"><link rel="prefetch" href="/assets/js/16.e9253bb0.js"><link rel="prefetch" href="/assets/js/17.2f2df1b1.js"><link rel="prefetch" href="/assets/js/18.cbb9c819.js"><link rel="prefetch" href="/assets/js/19.bc4d3a36.js"><link rel="prefetch" href="/assets/js/21.c42beae1.js"><link rel="prefetch" href="/assets/js/22.7f7759e8.js"><link rel="prefetch" href="/assets/js/23.324c37a3.js"><link rel="prefetch" href="/assets/js/24.4adf62c6.js"><link rel="prefetch" href="/assets/js/25.6925a4e6.js"><link rel="prefetch" href="/assets/js/26.16c4556d.js"><link rel="prefetch" href="/assets/js/27.bb4f278a.js"><link rel="prefetch" href="/assets/js/28.22912d99.js"><link rel="prefetch" href="/assets/js/3.0ab2436a.js"><link rel="prefetch" href="/assets/js/4.2a5d96fc.js"><link rel="prefetch" href="/assets/js/5.fd255a4a.js"><link rel="prefetch" href="/assets/js/6.66b67ff0.js"><link rel="prefetch" href="/assets/js/7.7ecf7e0a.js"><link rel="prefetch" href="/assets/js/8.e8e291f9.js"><link rel="prefetch" href="/assets/js/9.e9131e05.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js-promise"><a href="#js-promise" class="header-anchor">#</a> Js - Promise</h1> <h2 id="ä½“éªŒå¼‚æ­¥"><a href="#ä½“éªŒå¼‚æ­¥" class="header-anchor">#</a> ä½“éªŒå¼‚æ­¥</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// new Imageçš„ä½œç”¨ - https://www.jianshu.com/p/14853aee567b</span>
  <span class="token comment">// ç»Ÿè®¡ç½‘ç«™æµé‡ srcå±æ€§åšè¯·æ±‚ new image() åˆ›å»ºå›¾ç‰‡ä¸å¢åŠ DOMæ¸²æŸ“æ—¶é—´ åªå‘é€è¯·æ±‚(get)ã€‚ | ç¼“å­˜å›¾ç‰‡</span>
  <span class="token keyword">let</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  image<span class="token punctuation">.</span>onload <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
  image<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token string">'https://vxecho.gitee.io/node/logo.png'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å›¾ç‰‡åŠ è½½å®Œäº†ï½'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ‰§è¡Œç»“æœå¦‚ä¸‹ â¬‡ï¸</span>
<span class="token comment">// 123</span>
<span class="token comment">// å›¾ç‰‡åŠ è½½å®Œäº†ï½</span>
</code></pre></div><ul><li><p>å¼‚æ­¥æ‰§è¡Œ <code>æ˜¯å…ˆåŠ è½½å…ˆæ‰§è¡Œçš„, æ²¡æœ‰æ‰§è¡Œé¡ºåºçš„</code>ã€‚</p> <p>æ‰€ä»¥å‡ºç°äº† <code>å¼‚æ­¥å›è°ƒ - å›è°ƒåœ°ç‹±ï¼ˆcallbackåµŒå¥—ï¼‰</code> ç¡®ä¿ æŒ‰é¡ºåºåŠ è½½ã€‚</p> <p>è¿™ä¸ªæ—¶å€™ <strong><code>Promise</code></strong> å‡ºç°äº†ã€‚ ä½¿å¾—ä»£ç  æ›´åŠ æ˜“æ‡‚ï¼Œç„¶åå¯ä»¥<code>æ‰å¹³åŒ–å¤„ç†</code></p></li></ul> <h2 id="promise-jsçš„ä»»åŠ¡å¤„ç†æœºåˆ¶"><a href="#promise-jsçš„ä»»åŠ¡å¤„ç†æœºåˆ¶" class="header-anchor">#</a> <code>Promise</code> -  jsçš„ä»»åŠ¡å¤„ç†æœºåˆ¶</h2> <h3 id="promise-çš„çŠ¶æ€"><a href="#promise-çš„çŠ¶æ€" class="header-anchor">#</a> <code>promise</code> çš„çŠ¶æ€</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// pending å‡†å¤‡é˜¶æ®µ</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;pending&gt;}</span>
<span class="token comment">// resolved æˆåŠŸ çŠ¶æ€</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'æˆåŠŸçŠ¶æ€'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: &quot;æˆåŠŸçŠ¶æ€&quot;}</span>
<span class="token comment">// rejected æ‹’ç»/å¤±è´¥ çŠ¶æ€</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'å¤±è´¥çŠ¶æ€'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: &quot;æˆåŠŸçŠ¶æ€&quot;}</span>
</code></pre></div><h3 id="js-ä»»åŠ¡å¤„ç†æœºåˆ¶-å…¶å®å¯ä»¥å‚è€ƒ-event-loop"><a href="#js-ä»»åŠ¡å¤„ç†æœºåˆ¶-å…¶å®å¯ä»¥å‚è€ƒ-event-loop" class="header-anchor">#</a> js - ä»»åŠ¡å¤„ç†æœºåˆ¶ (å…¶å®å¯ä»¥å‚è€ƒ - <code>Event Loop</code>)</h3> <ul><li><p>å¥‡æ€ªçš„çŸ¥è¯†ç‚¹</p> <p>ç»™ <code>setTimeout</code> è®¾ç½® <code>0ç§’</code> æ‰§è¡Œã€‚ è™½ç„¶è®¾ç½®çš„æ˜¯0ç§’ï¼Œä½†å…¶å® js æ‰§è¡Œçš„æ—¶å€™æ˜¯ <code>4ms</code> æ‰§è¡Œçš„</p> <ul><li><strong>åœ¨ <code>é˜Ÿåˆ—{FIFO}</code> åšä»»åŠ¡è½®è¯¢ï¼Œ å…ˆè¿›å…ˆå‡º</strong></li></ul></li> <li><p><code>åŒæ­¥ä»£ç </code> &gt; <code>å¾®ä»»åŠ¡</code> &gt; <code>å®ä»»åŠ¡</code></p> <p>âš ï¸ æ¯æ¬¡æ‰§è¡Œ å®ä»»åŠ¡ä¹‹å‰éƒ½ä¼šå°† ç›®å‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºæ‰§è¡Œ ç„¶åå†æ‰§è¡Œå®ä»»åŠ¡</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿™é‡Œæ˜¯åŒæ­¥ä»£ç '</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âš ï¸ğŸ“</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// å› ä¸ºå®ƒ è¿”å›çš„æ˜¯ä¸€ä¸ª promise ç„¶åä¸‹é¢çš„ then ä¼šç­‰å¾…æ‰§è¡Œ</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è¿™é‡Œåªæœ‰ä¸Šé¢ resolve çš„é€šçŸ¥ä¹‹å æ‰ä¼šæ‰§è¡Œä»£ç ã€‚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="å®ä»»åŠ¡çš„æå‡-åŸæ¥æ˜¯è¯¯è§£"><a href="#å®ä»»åŠ¡çš„æå‡-åŸæ¥æ˜¯è¯¯è§£" class="header-anchor">#</a> å®ä»»åŠ¡çš„æå‡ - åŸæ¥æ˜¯è¯¯è§£</h3> <ul><li><p>åŒæ­¥ä»£ç æ‰§è¡Œå®Œæˆä¹‹åã€‚ä¼šå°† <code>å¼‚æ­¥</code> æ”¾å…¥åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œã€‚</p> <p><strong>âš ï¸ æ­¤åˆ»çš„åœ¨ä¸»çº¿ç¨‹ä»£ç  å¯ä»¥æŠŠå®ƒå½“ä½œ æ­£å¸¸æœºåˆ¶å¤„ç† - ç„¶åå°±å„ç§å¾ªç¯è¿™ç§æœºåˆ¶è°ƒç”¨äº† - <code>Event Loop</code></strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// âš ï¸ è¿™é‡Œ setTimeout å·²ç»æ‹¿åˆ°ä¸»çº¿ç¨‹æ¥æ‰§è¡Œäº†ã€‚ æ‰€ä»¥ ç°åœ¨æ˜¯ä¸»çº¿ç¨‹ä»£ç </span>
    <span class="token comment">// å¿…é¡»æŠŠ ä¸»çº¿ç¨‹é‡Œé¢ä»£ç æ‰§è¡Œå®Œæˆä¹‹å æ‰èƒ½å»åªæ‰§è¡Œ å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç„¶åæ‰§è¡Œ å¾®ä»»åŠ¡é‡Œé¢çš„ å¼‚æ­¥ä»£ç  - ä¸‹æ¬¡æ‰§è¡Œä¼šæŠŠå®ƒæ”¾ç½®åœ¨ä¸»çº¿ç¨‹ä¸Š</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âš ï¸ å¼‚æ­¥æ”¾åœ¨ä¸»çº¿ç¨‹é‡Œé¢ è¿™é‡Œå·²ç»æ˜¯åŒæ­¥ä»£ç äº†~</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŒæ­¥</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'guolin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŒæ­¥</span>
<span class="token comment">// promise</span>
<span class="token comment">// guolin</span>
<span class="token comment">// setTimeout</span>
<span class="token comment">// æˆåŠŸ</span>
</code></pre></div></li></ul> <h2 id="promise-çš„å•ä¸€çŠ¶æ€-å’Œ-çŠ¶æ€ä¸­è½¬"><a href="#promise-çš„å•ä¸€çŠ¶æ€-å’Œ-çŠ¶æ€ä¸­è½¬" class="header-anchor">#</a> <code>Promise</code> çš„å•ä¸€çŠ¶æ€ å’Œ çŠ¶æ€ä¸­è½¬</h2> <ul><li><p><code>Promise</code> çš„çŠ¶æ€æ”¹å˜ä¹‹åï¼Œå°±ä¼šè§¦å‘åé¢çš„äº‹ä»¶ã€‚</p> <p>æ‰€ä»¥ <strong><code>Promise</code>çŠ¶æ€æ˜¯å•ä¸€ è€Œä¸” ä¸å¯é€†çš„</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'æˆåŠŸ'</span><span class="token punctuation">)</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'å¤±è´¥'</span><span class="token punctuation">)</span>
  <span class="token comment">// promise çŠ¶æ€æ”¹å˜ä¹‹åæ˜¯ä¸å¯é€†çš„ å¦‚æœè¿”å›äº†æˆåŠŸ ç„¶åä¸‹é¢æ˜¯å¤±è´¥ æ˜¯æ— æ•ˆçš„</span>
  <span class="token comment">// åªè¦ çŠ¶æ€æ”¹å˜ åé¢å°±è§¦å‘äº†çŠ¶æ€ æ‰€ä»¥promise çŠ¶æ€æ˜¯å•ä¸€çš„ä¸å¯é€†çš„</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// p1 æ­¤åˆ»æ˜¯ä¸€ä¸ª promise</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿”å›ä¸€ä¸ªæˆåŠŸçš„promise ç„¶åè‚¯å®šèµ°çš„ then</span>
  <span class="token comment">// å¦‚æœ ä¸Šé¢æ˜¯ reject é‚£ä¹ˆp1 æ­¤åˆ»æ˜¯ä¸€ä¸ªå¤±è´¥çš„promiseç±»å‹çš„çš„ç»“æœ ä¹Ÿä¼šèµ° catch</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'then'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// then æˆåŠŸ</span>
</code></pre></div></li></ul> <h2 id="promise-then-çš„åŸºæœ¬ç”¨æ³•"><a href="#promise-then-çš„åŸºæœ¬ç”¨æ³•" class="header-anchor">#</a> <code>Promise.then()</code> çš„åŸºæœ¬ç”¨æ³•</h2> <ul><li><code>Promise.then()</code> è¿”å›çš„æ˜¯ ä¸€ä¸ª <code>promise</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'é”™è¯¯'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœåªå…³æ³¨å¤±è´¥å‰é¢æ˜¯éœ€è¦æœ‰çš„ éšä¾¿å¡«ä¸€ä¸ªå€¼å³å¯</span>
  <span class="token comment">// throw new Error('è¿™æ ·å‘¢ æ¥æ”¶ä»€ä¹ˆ') // å¦‚æœæŠ›å‡ºé”™è¯¯åœ¨å‰ é‚£ä¹ˆå°±ç›¸å½“äºæ”¹å˜äº† promise çš„çŠ¶æ€ æ‰€ä»¥ä¼šèµ°catch</span>
  <span class="token keyword">return</span> <span class="token string">'1'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œåˆæ¥æ”¶äº†ä¸€ä¸ª1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err1'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>å¦‚æœ<code>promise.then</code>(è¿™é‡Œå‘¢ä»€ä¹ˆä¹Ÿæ²¡æœ‰å¤„ç†é‚£ä¹ˆæˆ‘ä»¬å°±ä¼šä¸€ç›´å¾€åèµ°)<code>.then</code>(è¿™é‡Œä¹Ÿæ˜¯å¯ä»¥å¤„ç†ä¸Šä¸€ä¸ªè¿”å›ç»“æœçš„)</p> <p><strong>ä¸è¿‡ ä¸€èˆ¬ä¸è¿™ä¹ˆå†™ âœ¨âœ¨âœ¨</strong></p> <p>å¦‚æœ ç¬¬ä¸€ä¸ª <code>then</code> ä¸è¿”å›å€¼ï¼Œç¬¬äºŒä¸ª<code>then</code> ä¹Ÿæ˜¯ä¼šæ‰§è¡Œï¼Œåªæ˜¯ å¦‚æœä¸è¿”å›å€¼ï¼Œæ¥ä¸‹æ¥çš„<code>then</code>æ¥æ”¶ä¸åˆ°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'å“ˆå“ˆ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reason'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// console.log('p1', p1); // p1 Promise {&lt;resolved&gt;: &quot;å“ˆå“ˆ&quot;} - æˆåŠŸçŠ¶æ€</span>
<span class="token comment">// console.log('p2', p2); // p2 Promise {&lt;pending&gt;} - ç­‰å¾…çŠ¶æ€</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™æ ·çš„ç»“æœå°±æ˜¯ 'value å“ˆå“ˆ' - '1' - p1 - p2</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p1 Promise {&lt;resolved&gt;: &quot;å“ˆå“ˆ&quot;} - æˆåŠŸçŠ¶æ€</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p2'</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// âš ï¸ æ­¤æ—¶ ç”±äºå¾®ä»»åŠ¡å·²ç».thenäº† </span>
  <span class="token comment">// è€Œä¸”å®ä»»åŠ¡æ‰§è¡Œè¦æ¸…ç©ºç›®å‰å·²å­˜åœ¨çš„å¾®ä»»åŠ¡  æ‰€ä»¥è¿™æ—¶p2çš„çŠ¶æ€ - p2 Promise {&lt;resolved&gt;: undefined}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// resolve('å“ˆå“ˆ');</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'ğŸ˜‚å“ˆå“ˆå“ˆ'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ”¹å˜ä¸€ä¸‹å­</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reason'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™é‡Œçš„è¿™ä¸ª å¤„ç†æ˜¯å¯¹ ä¸Šä¸€ä¸ªpromise çŠ¶æ€ç»“æœçš„å¤„ç†</span>
  <span class="token comment">// æ— è®ºæˆåŠŸå¤±è´¥ éƒ½è·Ÿæˆ‘è¿™ä¸ª promise æ²¡æœ‰å…³ç³»äº† æˆ‘åªæ¥å—ä¸€ä¸ªç»“æœ</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æˆåŠŸ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å¤±è´¥'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// p1 - p3 - reason ğŸ˜‚å“ˆå“ˆå“ˆ - promise.js:144 æˆåŠŸ</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span> <span class="token comment">// æ­¤æ—¶æ‰“å° p1 å°±æ˜¯ p1 Promise {&lt;rejected&gt;: &quot;ğŸ˜‚å“ˆå“ˆå“ˆ&quot;}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'p3'</span><span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p3 Promise {&lt;pending&gt;} æ­¤åˆ»çš„p3 åˆæ˜¯ peding çŠ¶æ€</span>
</code></pre></div></li> <li><p><code>then</code>è¿”å›å€¼çš„å¤„ç†æŠ€å·§</p> <ul><li><p>åŸºç¡€</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ç¬¬ä¸€ä¸ªæˆåŠŸ'</span><span class="token punctuation">)</span>
  <span class="token comment">// reject('ç¬¬ä¸€ä¸ªå¤±è´¥')</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'å­—ç¬¦ä¸²'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'å¤±è´¥çš„å­—ç¬¦ä¸²'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¦‚æœp1è¿”å›çš„æ˜¯ resolve é‚£ä¹ˆæ­¤åˆ»çš„å€¼å°±æ˜¯ res å­—ç¬¦ä¸²</span>
  <span class="token comment">// å¦‚æœp1è¿”å›çš„æ˜¯ reject é‚£ä¹ˆæ­¤åˆ»çš„å€¼å°±æ˜¯ res å¤±è´¥çš„å­—ç¬¦ä¸²</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>å¦‚æœ return çš„æ˜¯ <code>promise</code> é‚£å°±ä¼šæ ¹æ® <code>promise</code> è¿”å›çš„çŠ¶æ€æ¥åšç›¸å¯¹åº”çš„å¤„ç†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ç¬¬ä¸€ä¸ªæˆåŠŸ'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// resolve('ç¬¬ä¸€ä¸ªæˆåŠŸ')</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'ç¬¬ä¸€ä¸ªå¤±è´¥'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'å¤±è´¥çš„å­—ç¬¦ä¸²'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¦‚æœ ä¸Šé¢ return çš„æ˜¯ promise é‚£å°±ä¼šæ ¹æ® promise è¿”å›çš„çŠ¶æ€æ¥åšç›¸å¯¹åº”çš„å¤„ç†</span>
  <span class="token comment">// âš ï¸ å…¶å®å¾ˆç®€å• å°±æ˜¯å¦‚æœè¿”å›çš„æ˜¯ promise çš„è¯ æˆ‘å°±ç›¸å½“äº initäº† ç„¶åæ ¹æ® æˆåŠŸ å¤±è´¥ æ¥åšåˆ¤æ–­</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¦‚æœä¸Šé¢ è¿”å›çš„æ˜¯ resolve é‚£ä¹ˆæ­¤åˆ»çš„å€¼å°±æ˜¯ res ç¬¬ä¸€ä¸ªæˆåŠŸ</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// å¦‚æœä¸Šé¢ è¿”å›çš„æ˜¯ resolve é‚£ä¹ˆæ­¤åˆ»çš„å€¼å°±æ˜¯ err ç¬¬ä¸€ä¸ªå¤±è´¥</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>ç„¶åéœ€è¦æ³¨æ„ <code>é“¾å¼.then</code> éœ€è¦ä¸Šä¸€ä¸ª <code>then</code>æ–¹æ³• <code>return</code> å‡ºæ¥æˆ‘ä»¬æ‰èƒ½å¯¹å…¶å¤„ç†</li> <li>å¦‚æœä¸ <code>return</code> é‚£æˆ‘ä»¬ <code>then</code> å°±æ˜¯å¯¹ä¸Šä¸€ä¸ª <code>then</code> è¿”å›çš„ <code>promise</code> è¿›è¡Œå¤„ç†</li> <li>æ¨è å¦‚æœä¸‹é¢æœ‰è¦<code>.then</code>çš„é“¾å¼æ“ä½œ æœ€å¥½ <code>return</code> æˆ–è€… è¿”å› <code>promise</code> æ¥è¿›è¡Œå¤„ç†</li></ul></li> <li><p><strong>è¿›é˜¶-åŠ æ·±ç†è§£ <code>.then(Promse.then()).then</code> å¤„ç†</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ç¬¬ä¸€ä¸ªæˆåŠŸ'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// resolve('ç¬¬ä¸€ä¸ªæˆåŠŸ')</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'ç¬¬ä¸€ä¸ªå¤±è´¥'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span> <span class="token string">'222'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'å¤±è´¥çš„å­—ç¬¦ä¸²'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// è¿™é‡Œ return new Promise.then äº†ä¹‹å é‚£å°±ä¼šç´§æ¥ç€å¯¹å…¶è¿›è¡Œå¤„ç†</span>
<span class="token comment">// ç„¶å æœ€ä¸‹é¢çš„ then æ˜¯å¯¹ return new Promise.then(è¿™é‡Œé¢è¿”å›å€¼çš„ä¸€ä¸ªå¤„ç†)</span>
<span class="token comment">// console.log('r', r);  ä¹‹åä¸ return å°±æ˜¯ä¸‹é¢è¿™ä¸ªç»“æœ</span>
<span class="token comment">// r ç¬¬ä¸€ä¸ªå¤±è´¥</span>
<span class="token comment">// res undefined</span>

<span class="token comment">// console.log('r', r);  ä¹‹å è¿”å› return '222' åˆ™æ˜¯ä¸‹é¢çš„ç»“æœ</span>
<span class="token comment">// r ç¬¬ä¸€ä¸ªå¤±è´¥</span>
<span class="token comment">// res 222</span>
</code></pre></div><ul><li>æ€»ä¹‹è¦è®°å¾—<code>return</code> åé¢çš„<code>.then()</code> å°±æ˜¯å¯¹å‰é¢çš„ <code>return</code> çš„å¤„ç†ï¼Œå¦‚æœ<code>return</code>çš„æ˜¯ <code>promise</code> é‚£åˆ™æ˜¯ä¼šæ ¹æ®çŠ¶æ€è¿”å› æ¥è¿›è¡Œæ“ä½œã€‚</li></ul></li></ul></li></ul> <h2 id="å…¶ä»–ç±»å‹çš„-promise-å°è£…"><a href="#å…¶ä»–ç±»å‹çš„-promise-å°è£…" class="header-anchor">#</a> å…¶ä»–ç±»å‹çš„ <code>Promise</code> å°è£…</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ç¬¬ä¸€ä¸ªæˆåŠŸ'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// return { name: '123' } // å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ é‚£ä¸‹é¢ then æ¥æ”¶çš„å°±æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ </span>
    <span class="token comment">// return { // å¦‚æœ è¿”å›çš„æ˜¯ thenæ–¹æ³• è¿™æ—¶å€™çš„then å°±ä¼šè¢«å°è£…æˆ promise ç„¶åä¸‹é¢æ¥æ”¶</span>
    <span class="token comment">//   then(resolve, reject) {</span>
    <span class="token comment">//     resolve('è¿™æ˜¯ä¸ªå¯¹è±¡')</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>
    <span class="token comment">// class Gl {</span>
    <span class="token comment">//   then(resolve, reject) {</span>
    <span class="token comment">//     resolve('æˆ‘æ˜¯ class é‡Œé¢çš„thenæ–¹æ³•')</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>
    <span class="token comment">// return new Gl(); // å› ä¸º new å‡ºæ¥çš„å®ä¾‹å¯¹è±¡é‡Œé¢ æœ‰then æ–¹æ³• æ‰€ä»¥å°±ä¼šè¢«æ¥æ”¶åˆ°</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token punctuation">{</span> <span class="token comment">// è¿”å›çš„ class é‡Œ æœ‰é™æ€çš„ then æ–¹æ³• æ‰€ä»¥ä¹Ÿä¼šè¢«æ¥æ”¶åˆ° </span>
      <span class="token keyword">static</span> <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'æˆ‘æ˜¯ class é‡Œé¢çš„thenæ–¹æ³•'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯¹åº”è¿”å› æ™®é€šå¯¹è±¡ æ—¶å€™çš„æ‰“å° - value {name: &quot;123&quot;}</span>
    <span class="token comment">// å¯¹åº”è¿”å› å¯¹è±¡é‡Œé¢ ç‰¹æ®Šçš„æ–¹æ³• then çš„æ—¶å€™çš„æ‰“å° - value è¿™æ˜¯ä¸ªå¯¹è±¡</span>
    <span class="token comment">// å¯¹åº”è¿”å› new class é‡Œé¢æœ‰thenæ–¹æ³• çš„æ—¶å€™æ‰“å° - value æˆ‘æ˜¯ class é‡Œé¢çš„thenæ–¹æ³•</span>
    <span class="token comment">// å¯¹åº”è¿”å› class é‡Œé¢æœ‰ é™æ€çš„thenæ–¹æ³• çš„æ—¶å€™æ‰“å° - value æˆ‘æ˜¯ class é‡Œé¢çš„é™æ€æ–¹æ³•</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// âš ï¸æ³¨æ„ï¼š æœ€ä¸‹é¢çš„then æ¥æ”¶çš„æ—¶å€™ ä¼šæ£€æŸ¥ ç±»å‘€æˆ–è€…å¯¹è±¡å‘€ é‡Œé¢æœ‰æ²¡æœ‰ then æ–¹æ³• ç„¶åä¼šç›´æ¥è°ƒç”¨</span>
  <span class="token comment">// ä½†æ˜¯éœ€è¦ ä»¥ promise çš„å½¢å¼è¿”å› ç„¶åæ‰ä¼šè¢«æ¥æ”¶åˆ°  å¦‚æœ ä¸è¿”å›çŠ¶æ€ é‚£ä¹Ÿä¼šæ‰§è¡Œ ä¸Šé¢ then æ–¹æ³•é‡Œé¢çš„ä»£ç </span>
</code></pre></div><h2 id="promiseçš„ä¼ä¸šçº§ç†è§£-æ„šè§"><a href="#promiseçš„ä¼ä¸šçº§ç†è§£-æ„šè§" class="header-anchor">#</a> <code>Promise</code>çš„ä¼ä¸šçº§ç†è§£ - æ„šè§</h2> <ul><li><p>ğŸ“ çªç„¶æƒ³èµ· æˆ‘ä»¬æ¥æ”¶çš„åå°å‚æ•° ä¸å°±æ˜¯åœ¨ <code>axios</code> é‡Œé¢æ‹¦æˆªå™¨ ç»Ÿä¸€è¿”å›æˆ<code>promise</code>ç„¶åå†å¤„ç†çš„å— -  <code>return Promise.resolve(ç»“æœ)</code></p></li> <li><p>ğŸ˜± <code>amazing</code> ç¥å¥‡</p></li> <li><p>ğŸ’¦ ä¸è¿‡å¥½åƒ <code>axios</code> è¿”å›çš„å°±æ˜¯ <code>promise</code> å“ˆå“ˆå“ˆ è™½ç„¶ä½†æ˜¯  è¿˜æ˜¯è¦å°è£…ä¸€ä¸‹çš„ - ä½†æ˜¯å¯ä»¥å¯¹ <code>ajax</code> å•¥çš„è¿›è¡Œå°è£… ä½¿ç”¨ <code>.then</code></p></li> <li><p>é’ˆå¯¹ä¸ ä¹‹å‰çš„ å›è°ƒåœ°ç‹± å„ç§åµŒå¥—</p> <ul><li><p>å¦‚æœæœ‰ ä¸€ä¸ªåè®®éœ€è¦ä¸Šä¸€ä¸ªåè®® è¯·æ±‚åçš„ç»“æœçš„æ—¶å€™ å°±æœ€å¥½æ˜¯ æ‰å¹³åŒ–è°ƒç”¨ä¸€ä¸‹</p> <p><code>.then(value =&gt; axios(åè®®è¯·æ±‚ - å–ç¬¬ä¸€ä¸ªåè®®è¿”å›çš„ç»“æœ)).then(value =&gt; ç¬¬äºŒä¸ªåè®®åšå¤„ç†)</code></p></li></ul></li></ul> <h2 id="promiseçš„é”™è¯¯ç›‘æµ‹-å’Œ-catchçš„ä½¿ç”¨"><a href="#promiseçš„é”™è¯¯ç›‘æµ‹-å’Œ-catchçš„ä½¿ç”¨" class="header-anchor">#</a> <code>Promise</code>çš„é”™è¯¯ç›‘æµ‹ å’Œ <code>catch</code>çš„ä½¿ç”¨</h2> <ul><li><code>reject('é”™è¯¯1')</code> - åŸºç¡€çš„</li> <li><code>reject(new Error('é”™è¯¯1'))</code> - è‡ªå·± <code>new</code> ä¸€ä¸ªé”™è¯¯ç±»å‹</li> <li><code>throw new Error('fail')</code> - è‡ªå·±æŠ›å‡ºé”™è¯¯ç±»å‹ä¹Ÿæ˜¯å¯ä»¥çš„</li> <li><code>gl + 1</code> - ä¸æ˜å˜é‡ ä¹Ÿä¼šè¢« catch æˆ–è€… err æ¥æ”¶åˆ°`</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'é”™è¯¯1'</span><span class="token punctuation">)</span> <span class="token comment">// åŸºç¡€çš„</span>
  <span class="token comment">// âš ï¸ ç›¸å½“äº å†…éƒ¨ åšäº†ä¸€ä¸ª try {} catch (error) {} ç›‘æµ‹</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>âœ¨âœ¨âœ¨<strong>å¦‚æœå¤šä¸ª<code>.then</code> è°ƒç”¨çš„è¯ å¤„ç†é”™è¯¯ å…¶å®å°±æ˜¯ æœ€åè°ƒç”¨ä¸€ä¸‹ <code>catch</code> å°±å¯ä»¥</strong> <ul><li>å¤šä¸ª <code>.then</code> é“¾å¼è°ƒç”¨ å¯ä»¥æ¯ä¸ªéƒ½å†™ <code>catch</code> æ¥æ•è· ä¹Ÿå¯ä»¥ æœ€åè°ƒç”¨ <code>catch</code> æ¥åšç»Ÿä¸€å¤„ç†</li> <li>æ¨è æœ€åå†™ catch æ¥åšç»Ÿä¸€æ•è·
<ul><li>å› ä¸ºå¦‚æœè¿ç»­ä¸¤ä¸ª catch ç¬¬äºŒä¸ªåªä¼šæ•è·ä¸´è¿‘æ²¡æœ‰ é”™è¯¯å¤„ç†çš„ä»£ç  ä¸ä¼šæ“ä½œå·²ç»æœ‰é”™è¯¯å¤„ç†çš„ä»£ç äº†</li> <li>å¦‚æœ catch ä¹‹å‰ æ²¡æœ‰é”™è¯¯å¤„ç† é‚£å°±éƒ½ä¼šèµ° catch æ¥è¿›è¡Œé”™è¯¯å¤„ç†</li> <li>å¦‚æœ catch ä¹‹å‰ æœ‰é”™è¯¯å¤„ç†çš„å›è°ƒï¼Œ é‚£å°±èµ° ä¸´è¿‘çš„ ä¸‹ä¸€ä¸ªè¿›è¡Œé”™è¯¯å¤„ç† å¹¶ ä¹‹åçš„é”™è¯¯å¤„ç†ä¸ä¼šæ•è· ä¹‹å‰çš„é”™è¯¯å¤„ç†</li></ul></li></ul></li></ul> <h2 id="è‡ªå®šä¹‰é”™è¯¯å¤„ç†"><a href="#è‡ªå®šä¹‰é”™è¯¯å¤„ç†" class="header-anchor">#</a> è‡ªå®šä¹‰é”™è¯¯å¤„ç†</h2> <ul><li><p>ç»§æ‰¿äº† Error ä¹‹å å°±å¯ä»¥ä½¿ç”¨ å…ˆå¯¹åº”çš„é”™è¯¯å¤„ç†äº†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">paramError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'paramError'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ‰“å°çš„æ—¶å€™ å› ä¸º new Error æ˜¯å¯¹è±¡ ç„¶å å¯ä»¥ æ‰“å° new Error().message æ¥è¿›è¡Œ é”™è¯¯æ¶ˆæ¯ æç¤º</span>
<span class="token comment">//  ç¥å¥‡ âš ï¸ -  ä¹Ÿå¯ä»¥åœ¨é”™è¯¯å¤„ç†çš„æ—¶å€™ è¿›è¡Œ  instanceof åˆ¤æ–­ </span>
<span class="token comment">// è¿”å› reject(new ParamError('å‚æ•°é”™è¯¯'))</span>
<span class="token comment">// ç„¶å å‰ç«¯ catch çš„æ—¶å€™ åˆ¤æ–­ if (err instanceof paramError) { ...ç„¶ååšç›¸å¯¹åº”çš„å¤„ç† }</span>
</code></pre></div></li></ul> <h2 id="ä½¿ç”¨-finally-å®ç°å¼‚æ­¥åŠ è½½åŠ¨ç”»"><a href="#ä½¿ç”¨-finally-å®ç°å¼‚æ­¥åŠ è½½åŠ¨ç”»" class="header-anchor">#</a> ä½¿ç”¨ <code>finally</code> å®ç°å¼‚æ­¥åŠ è½½åŠ¨ç”»</h2> <ul><li><p><code>finally</code>æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥çš„æ—¶å€™ å§‹ç»ˆä¼šæ‰§è¡Œ(åªè¦æ‰§è¡Œå®Œæˆ)</p> <p>å¯ä»¥ç”¨æ¥åš åŠ è½½åŠ¨ç”» çš„ï¼Œä¸å…³å¿ƒæˆåŠŸå¤±è´¥ åªè¦å®Œæˆå°±å¯ä»¥ç»“æŸåŠ¨ç”»</p> <div class="language- extra-class"><pre class="language-text"><code>.then() &amp; .catch() &amp; .finally
</code></pre></div></li> <li><p>ğŸ“âš ï¸ğŸƒ <strong>å¥‡æ€ªçš„çŸ¥è¯†</strong></p> <p><strong>htmlé‡Œé¢ æ ‡ç¤º id çš„æ ‡ç­¾ å¯ä»¥åœ¨ js é‡Œé¢ç›´æ¥ä½¿ç”¨</strong></p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
id1<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token comment">// æ˜¯å¯ä»¥ input è¿›å»çš„</span>
</code></pre></div></li></ul> <h2 id="ä½¿ç”¨-promise-å°è£…"><a href="#ä½¿ç”¨-promise-å°è£…" class="header-anchor">#</a> ä½¿ç”¨ <code>Promise</code> å°è£…</h2> <ul><li><p>å¼‚æ­¥åŠ è½½å›¾ç‰‡</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    image<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
    image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    image<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token string">'...url'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reason'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>setTimeout</code> å®šæ—¶å™¨</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">1000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å“ˆå“ˆå“ˆ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å¦‚æœä¸è¿”å› ç¬¬äºŒä¸ª then è¿˜æ˜¯ä¼šæ‰§è¡Œçš„'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åªæ˜¯æ¥å—ä¸åˆ°å€¼</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// æ‰“å°å¦‚ä¸‹ â¬‡ï¸</span>
<span class="token comment">// å“ˆå“ˆå“ˆ</span>
<span class="token comment">// å¦‚æœä¸è¿”å› ç¬¬äºŒä¸ª then è¿˜æ˜¯ä¼šæ‰§è¡Œçš„</span>
</code></pre></div></li> <li><p>æ„å»º æ‰å¹³åŒ–çš„ <code>setInterval</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™å—æ‹¿çš„å°±æ˜¯ Promise().resolve() ç„¶åä¸Šé¢ return promise æ‰€ä»¥ 2 è¿™ä¸ªç»“æœ ä¸‹é¢ .then æ˜¯å¯ä»¥æ¥æ”¶åˆ°çš„</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 ç«Ÿç„¶æ‰“å°äº†...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="script-è„šæœ¬ä¸­çš„-promise-åŠ è½½å¼•æ“ã€‚"><a href="#script-è„šæœ¬ä¸­çš„-promise-åŠ è½½å¼•æ“ã€‚" class="header-anchor">#</a> <code>script</code> è„šæœ¬ä¸­çš„ <code>Promise</code> åŠ è½½å¼•æ“ã€‚</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ä¸æ¨èè¿™æ ·å†™ âŒ</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// tag:1</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œçš„ .then æ¥å—çš„æ˜¯ tag:1 é‡Œé¢çš„ .then()</span>
<span class="token comment">// æ¨èè¿™æ ·å†™ âœ…</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ¨èè¿™æ ·å†™ è¿™æ ·å’Œ tag:1 çš„ç»“æœç±»ä¼¼</span>
</code></pre></div><h2 id="promise-resolve-ç¼“å­˜åå°æ•°æ®"><a href="#promise-resolve-ç¼“å­˜åå°æ•°æ®" class="header-anchor">#</a> <code>Promise.resolve()</code> - ç¼“å­˜åå°æ•°æ®</h2> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'å“ˆå“ˆå“ˆ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: &quot;å“ˆå“ˆå“ˆ&quot;} - æˆåŠŸçŠ¶æ€</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'å“ˆå“ˆå“ˆ'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™æ ·å†™ é»˜è®¤å°±æ˜¯æˆåŠŸ çš„</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å“ˆå“ˆå“ˆ</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ä¸€æ ·çš„æ•°æ® - å­˜ä¸‹ç¼“å­˜ - é˜²æ­¢é‡å¤è¯·æ±‚</span>
<span class="token keyword">function</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å‡½æ•°æœ¬æ¥ä¹Ÿæ˜¯å¯¹è±¡ å¯ä»¥å¾€é‡Œé¢ å‹å±æ€§</span>
  <span class="token keyword">const</span> cache <span class="token operator">=</span> query<span class="token punctuation">.</span>cache <span class="token operator">||</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ğŸ“èµ°ç¼“å­˜äº†'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token string">'...url'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ²¡æœ‰èµ°ç¼“å­˜'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p><code>Promise.resolve</code>æ‰‹å†™ç±»ä¼¼ä»£ç </p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function-variable function">gl</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">gl</span><span class="token punctuation">(</span><span class="token string">'éƒ­éœ–'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: &quot;éƒ­éœ–&quot;}</span>
</code></pre></div></li></ul> <h2 id="promise-reject-çš„ä½¿ç”¨"><a href="#promise-reject-çš„ä½¿ç”¨" class="header-anchor">#</a> <code>Promise.reject()</code> çš„ä½¿ç”¨</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å¯¹è±¡é‡Œé¢ åŒ…æ‹¬ then æ–¹æ³• è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥è°ƒç”¨çš„</span>
<span class="token keyword">let</span> gl <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'éƒ­éœ–'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// ä¼šè‡ªåŠ¨å¯»æ‰¾å¯¹è±¡é‡Œçš„ then æ–¹æ³• ç„¶åè¿›è¡Œè°ƒç”¨</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éƒ­éœ–</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'éƒ­éœ–'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token string">'æˆåŠŸ'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// throw new Error('fail') // å¯ä»¥è¿™ä¹ˆå†™</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'å‚æ•°é”™è¯¯'</span><span class="token punctuation">)</span> <span class="token comment">// ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ è¿™é‡Œéœ€è¦å†™ return éœ€è¦æ¥å— promiseè¿˜æ˜¯valueå€¼ç±»å‹</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reason'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span> <span class="token comment">// reason Error: fail</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="promise-all-æ‰¹é‡è·å–æ•°æ®"><a href="#promise-all-æ‰¹é‡è·å–æ•°æ®" class="header-anchor">#</a> <code>Promise.all()</code> æ‰¹é‡è·å–æ•°æ®</h2> <ul><li><p>éœ€è¦æ‰€æœ‰éƒ½è¿”å›æˆåŠŸ <code>all</code> æ‰ä¼šæˆåŠŸ å¦‚æœæœ‰ä¸€é¡¹å¤±è´¥äº†é‚£ <code>all</code> å°±æ•´ä½“å¤±è´¥äº†~</p> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// âš ï¸ è¿™é‡Œå¦‚æœ p1 p2 æ²¡æœ‰å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œåœ¨ allé‡Œé¢ æ˜¯å¯ä»¥ç»Ÿä¸€å¤„ç†çš„</span>
 <span class="token comment">// âš ï¸ å¦‚æœå…¶ä¸­ä¸€é¡¹ ä¾‹å¦‚-p1-å·²ç»åšå‡ºäº†å¤„ç† é‚£ä¹ˆå°±å·²ç»æ˜¯è§£å†³çŠ¶æ€ ç„¶åç„¶åæ²¡æœ‰ç»§ç»­ return é‚£å°±æ¥å—çš„å°±æ˜¯ undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// `Promise.all()` æ˜¯éœ€è¦ æ‰€æœ‰éƒ½è¿”å›æˆåŠŸä¹‹å æ‰ä¼šæˆåŠŸã€‚</span>
<span class="token comment">// `promise.allSettled()` æ˜¯æˆåŠŸ å¤±è´¥éƒ½å¯ä»¥ éƒ½ä¼šç»™ä¿å­˜ä¸‹æ¥ã€‚ </span>
<span class="token comment">//    å¦‚æœ å¤±è´¥äº† ä¹Ÿä¼šä¿å­˜ä¸‹æ¥ ç„¶åéƒ½ä¼šèµ° `.then` åªä¸è¿‡ æˆåŠŸå’Œå¤±è´¥ è¿”å›çš„çŠ¶æ€ä¸åŒ åˆ¤æ–­ status === 'fulfilled' æˆåŠŸçš„~</span>
<span class="token comment">// è¿”å›æ¥çš„ç»“æ„å°±æ˜¯ { status: çŠ¶æ€, value: è¿”å›æ¥çš„å€¼ }</span>
</code></pre></div></li></ul> <h2 id="promise-race-è¿™ä¸ªå°±æ˜¯æˆ‘å¯ä»¥æ¥æ”¶å¤šä¸ª-promise-ä½†æ˜¯æˆ‘åªå–-æœ€å¿«çš„ä¸€ä¸ª-promise"><a href="#promise-race-è¿™ä¸ªå°±æ˜¯æˆ‘å¯ä»¥æ¥æ”¶å¤šä¸ª-promise-ä½†æ˜¯æˆ‘åªå–-æœ€å¿«çš„ä¸€ä¸ª-promise" class="header-anchor">#</a> <code>Promise.race</code> - è¿™ä¸ªå°±æ˜¯æˆ‘å¯ä»¥æ¥æ”¶å¤šä¸ª <code>promise</code> ä½†æ˜¯æˆ‘åªå– <strong>æœ€å¿«çš„ä¸€ä¸ª <code>promise</code></strong></h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åå°è¯·æ±‚è¶…æ—¶å¤„ç† - å°è£…ä¸€ä¸‹ </span>
<span class="token keyword">function</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">2000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment">// axios(url),</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'è¯·æ±‚è¶…æ—¶'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'www.//...'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="promise-é˜Ÿåˆ—åŸç†"><a href="#promise-é˜Ÿåˆ—åŸç†" class="header-anchor">#</a> <code>Promise</code> é˜Ÿåˆ—åŸç†</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯ ä¾æ¬¡æ‰§è¡Œçš„  ç„¶åç­‰ä¸Šä¸€ä¸ªçŠ¶æ€è¿”å›æ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ª then å’Œ promise çš„</span>
<span class="token comment">// åŸç†å°±æ˜¯ é˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªæˆå‘˜éƒ½æ˜¯ promise ç„¶åä¸‹ä¸€ä¸ªéœ€è¦ç­‰ä¸Šä¸€ä¸ªçš„çŠ¶æ€æ”¹å˜ã€‚</span>
</code></pre></div><h3 id="ä½¿ç”¨-map-å®ç°-promise-é˜Ÿåˆ—"><a href="#ä½¿ç”¨-map-å®ç°-promise-é˜Ÿåˆ—" class="header-anchor">#</a> ä½¿ç”¨ <code>map</code> å®ç° <code>promise</code> é˜Ÿåˆ—</h3> <ul><li><strong>æ€»ä¹‹å°±æ˜¯ æ¯æ¬¡ èµ‹å€¼ç»™ promise å˜é‡ï¼Œ å› ä¸ºæ¯æ¬¡ then æ‰§è¡Œä¸‹ä¸€æ¬¡éƒ½è·å–åˆ°ä¸Šä¸€æ¬¡ promise è¿”å›çš„ç»“æœ</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  num<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// âš ï¸ è¿™å—æ˜¯ä¸»è¦çš„ promise æ¯æ¬¡éƒ½èµ‹å€¼ ç„¶åä¸€æ¬¡é˜Ÿåˆ—è°ƒç”¨</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ”¹å˜çŠ¶æ€ä¹‹å ç»“åˆå®šæ—¶å™¨ å°±å¯ä»¥å®ç° ä¾æ¬¡æ‰“å°äº†</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ€»ä¹‹å°±æ˜¯ æ¯æ¬¡ èµ‹å€¼ç»™ promise å˜é‡ï¼Œ å› ä¸ºæ¯æ¬¡ then æ‰§è¡Œä¸‹ä¸€æ¬¡éƒ½è·å–åˆ°ä¸Šä¸€æ¬¡ promise è¿”å›çš„ç»“æœ</span>
<span class="token comment">// setTimeout åªæ˜¯æ¨¡æ‹Ÿ apiè°ƒç”¨çš„æ—¶è€—ã€‚ ç„¶åæ¯æ¬¡éƒ½1ç§’å è¿”å›çŠ¶æ€ ç„¶åä¸‹ä¸ªthen æ¥æ”¶åˆ° æ¥ç€æ‰§è¡Œ</span>
<span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œå‚æ•° å¯ä»¥æ¢æˆ promise æ•°ç»„ ç„¶åå°±å¯ä»¥å®ç° å¤šä¸ªpromise ä¾æ¬¡æ‰§è¡Œçš„åŠŸæ•ˆäº†</span>
</code></pre></div><h3 id="ä½¿ç”¨-reduce-æ¥å®ç°-promise-é˜Ÿåˆ—"><a href="#ä½¿ç”¨-reduce-æ¥å®ç°-promise-é˜Ÿåˆ—" class="header-anchor">#</a> ä½¿ç”¨ <code>reduce</code> æ¥å®ç° <code>promise</code> é˜Ÿåˆ—</h3> <ul><li>ä¿è¯ <code>then</code> æ˜¯è¿ç»­çš„ï¼Œ æ¯æ¬¡çš„ <code>promise</code> åˆæ˜¯ä¸€ä¸ªæ–°çš„ <code>promise</code> å°±å¯ä»¥äº†</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  num<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™å—æ¯æ¬¡è¿”å› å°±æ˜¯ä¸€ä¸ª æ–°çš„ new Promise() å¯¹è±¡</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ä½¿ç”¨-promise-é˜Ÿåˆ—æ¥æ¸²æŸ“æ•°æ®"><a href="#ä½¿ç”¨-promise-é˜Ÿåˆ—æ¥æ¸²æŸ“æ•°æ®" class="header-anchor">#</a> ä½¿ç”¨ <code>promise</code> é˜Ÿåˆ—æ¥æ¸²æŸ“æ•°æ®</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// eg: </span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¯·æ±‚æ•°æ®çš„æ–¹æ³•</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">users</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    users<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token comment">// è¿™å—æ˜¯å°è£…çš„ajaxæ–¹æ³•ç„¶åæ˜¯è¿”å›æ•°æ®çš„æ–¹æ³•</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™å—æ˜¯ è‡ªåŠ¨å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ è·å–ä¸€ä¸ª æ¸²æŸ“ä¸€ä¸ªçš„æ„æ€</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¸²æŸ“é¡µé¢çš„æ–¹æ³•</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'params-eg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="async-await-è¯­æ³•ç³–"><a href="#async-await-è¯­æ³•ç³–" class="header-anchor">#</a> <code>async-await</code> è¯­æ³•ç³–</h2> <ul><li><p>âš ï¸ await å¿…é¡»è¦åœ¨ async å£°æ˜çš„å‡½æ•°ä¸­æ‰å¯ä»¥ç”Ÿæ•ˆ ä¸ç„¶ä¼šæŠ¥é”™</p></li> <li><p><strong><code>async å‡½æ•°</code>  è¿™ä¸ªå°±ç›¸å½“äº æˆ‘ä»¬ <code>new Promise()</code> çš„åšæ³•</strong></p></li> <li><p><strong><code>await promise</code> è¿™ä¸ªå°±ç›¸å½“äº æˆ‘ä»¬ <code>.then()</code> çš„åšæ³•</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span> <span class="token comment">// è¿™ä¸ªå°±ç›¸å½“äº æˆ‘ä»¬ new Promise() çš„åšæ³•</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: undefined} âš ï¸ - è¿™é‡Œçš„ promise çŠ¶æ€æ˜¯å·²è§£å†³çš„çŠ¶æ€async function gl() {</span>
<span class="token punctuation">}</span> <span class="token comment">// è¿™ä¸ªå°±ç›¸å½“äº æˆ‘ä»¬ new Promise() çš„åšæ³•</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: undefined} âš ï¸ - è¿™é‡Œçš„ promise çŠ¶æ€æ˜¯å·²è§£å†³çš„çŠ¶æ€</span>
</code></pre></div></li></ul> <h3 id="promise-çš„è¯­æ³•ç³–-async"><a href="#promise-çš„è¯­æ³•ç³–-async" class="header-anchor">#</a> <code>promise</code> çš„è¯­æ³•ç³– <code>async</code></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'guolin'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// guolin</span>
</code></pre></div><h3 id="then-çš„è¯­æ³•ç³–-await"><a href="#then-çš„è¯­æ³•ç³–-await" class="header-anchor">#</a> <code>then</code> çš„è¯­æ³•ç³–  `await</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// let name = await 'guolin'; // è¿™é‡Œç›¸å½“äº Promise.resolve('guolin') ä½†è¿™é‡Œæ˜¯ promiseçš„ ç±»å‹</span>
  <span class="token comment">// console.log(name); // guolin</span>

  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// await å°±æ˜¯ then çš„ç®€å†™</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'guolin'</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœä¸æ”¹å˜çŠ¶æ€ resolve é‚£å°±æ°¸è¿œæ— æ³• è¾“å…¥ name ä¸€ç›´åœ¨ç­‰å¾…</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// guolin</span>
  <span class="token comment">// await å…¶å®å°±æ˜¯ é¿å…é¢‘ç¹çš„ new Promise() çš„å†™æ³•</span>
<span class="token punctuation">}</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="async-å»¶æ—¶å‡½æ•°"><a href="#async-å»¶æ—¶å‡½æ•°" class="header-anchor">#</a> <code>async</code> å»¶æ—¶å‡½æ•°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">slepp</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">2000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">slepp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å› ä¸ºè¿™é‡Œåœ¨ç­‰ promise çš„çŠ¶æ€æ”¹å˜ 2ç§’åæ”¹å˜ ç„¶åè¾“å‡ºå†…å®¹</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¯éš”ä¸¤ç§’ æ‰“å° g ç„¶å l</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="class-ä¸-async-çš„ç»“åˆä½¿ç”¨"><a href="#class-ä¸-async-çš„ç»“åˆä½¿ç”¨" class="header-anchor">#</a> <code>class</code> ä¸ <code>async</code> çš„ç»“åˆä½¿ç”¨</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœä¸€ä¸ªç±»ä¸­ åŒ…å«æœ‰ä¸€ä¸ª then æ–¹æ³• </span>
    <span class="token comment">// é‚£åœ¨äº promise ä½¿ç”¨çš„æ—¶å€™ å°±ä¼šåŒ…è£…æˆä¸€ä¸ª promise çš„thenæ–¹æ³•</span>
    <span class="token comment">// resolve();</span>

    <span class="token comment">// å¦‚æœé‡Œé¢æœ‰ å¼‚æ­¥è°ƒç”¨æ“ä½œæ–¹æ³• é‚£ä¹ˆå³ä½¿è°ƒç”¨å®Œäº†ä¸‹é¢ä¹Ÿä¸ä¼šæ‰“å°</span>
    <span class="token comment">// éœ€è¦ æ”¹å˜ä¸€ä¸‹çŠ¶æ€ï¼Œ å¦‚æœæœ‰éœ€è¦ä½¿ç”¨çš„å€¼ ä¼ é€’å°±å¯ä»¥äº†</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç„¶åæ”¹å˜çŠ¶æ€ä¹‹å ä¸‹é¢await å°±ä¼šé‡Šæ”¾æ‰§è¡Œäº†</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'guolin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœ Useré‡Œé¢çš„ then æ–¹æ³• æ²¡æœ‰è¿”å›çŠ¶æ€ åé¢çš„ æ‰“å°æ˜¯ä¸ä¼šæ‰§è¡Œçš„</span>
  <span class="token comment">// await ä¼šç­‰å¾… promise è¿”å›çš„çŠ¶æ€ä¹‹åæ‰æ‰“å°</span>
<span class="token punctuation">}</span>
<span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>å¼‚æ­¥å°è£…åœ¨ç±»çš„ å†…éƒ¨</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>
  <span class="token comment">// get(name) {</span>
  <span class="token comment">//   let user = ajax(`è¯·æ±‚è°ƒç”¨çš„api`);</span>
  <span class="token comment">//   user.name += '-guolin'ï¼›</span>
  <span class="token comment">//   console.log(user); // è¿™é‡Œè¿™æ ·å†™ å¼‚æ­¥äº† ç„¶å user.nameå¾ˆæœ‰å¯èƒ½æ˜¯ undefined </span>
  <span class="token comment">//   return user;</span>
  <span class="token comment">// }</span>

  <span class="token comment">// ä½¿ç”¨ then ä¹Ÿè¡Œ async await æ›´å¥½æ›´ç›´è§‚</span>
  <span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">è¯·æ±‚è°ƒç”¨çš„api</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™æ ·å°±ä¿è¯æ‰§è¡Œäº† åŒæ­¥äº†</span>
    user<span class="token punctuation">.</span>name <span class="token operator">+=</span> <span class="token string">'-guolin'</span>ï¼›
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'guolin1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// await å°±æ˜¯ then çš„è¯­æ³•ç³–</span>
  <span class="token comment">// è¿™é‡Œçš„ then å°±å¯ä»¥æ¥æ”¶åˆ° ä¸Šé¢çš„ return çš„ç»“æœäº†</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="async-await-çš„å‡ ç§å£°æ˜æ–¹å¼"><a href="#async-await-çš„å‡ ç§å£°æ˜æ–¹å¼" class="header-anchor">#</a> <code>async-await</code> çš„å‡ ç§å£°æ˜æ–¹å¼</h2> <ul><li><p><code>async function get() { await ... }</code> - å‡½æ•°å£°æ˜</p></li> <li><p><code>let get = async function() { await ... }</code> -  å‡½æ•°è¡¨è¾¾å¼çš„å£°æ˜</p></li> <li><p>å¯¹è±¡å£°æ˜</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> gl <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// å¯¹è±¡å£°æ˜</span>
  <span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
gl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>class</code> å£°æ˜</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span> <span class="token comment">// class å£°æ˜</span>
  <span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">await</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="âš ï¸ğŸ“-async-await-çš„é”™è¯¯å¤„ç†"><a href="#âš ï¸ğŸ“-async-await-çš„é”™è¯¯å¤„ç†" class="header-anchor">#</a> âš ï¸ğŸ“ <code>async - await</code> çš„é”™è¯¯å¤„ç†</h2> <h3 id="async-çš„é”™è¯¯å¤„ç†"><a href="#async-çš„é”™è¯¯å¤„ç†" class="header-anchor">#</a> ``async` çš„é”™è¯¯å¤„ç†</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// æ™®é€š promise çš„é”™è¯¯å¤„ç†</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// âš ï¸ğŸ“ è¿™é‡Œçš„ catch é™¤äº† æ•è·åè®®ä¸Šçš„é”™è¯¯ </span>
  <span class="token comment">// ğŸ“ ä¹Ÿä¼šæ•è· ä»£ç é‡Œé¢å‘ç”Ÿçš„é”™è¯¯ ç›¸å½“äº å†…éƒ¨éšå½¢çš„ä¸€ä¸ª try catch</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: fail</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// throw new Error('fail') // è‡ªå·±æŠ›å‡ºçš„ä¹Ÿä¼šå¤„ç†</span>
<span class="token punctuation">}</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// å› ä¸º async æ˜¯ promise è¯­æ³•ç³– è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥å¯¹é”™è¯¯è¿›è¡Œå¤„ç†çš„</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: a is not defined</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¹Ÿæ˜¯å¯ä»¥æ•è·åˆ° apiåè®® çš„é”™è¯¯çš„</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="ğŸ“-ä¸ä»…è¦è€ƒè™‘-æˆåŠŸä¹‹åæ•°æ®çš„å¤„ç†-æ›´å¥½è€ƒè™‘-å‡ºé”™è¯¯çš„æ—¶å€™çš„é”™è¯¯å¤„ç†-ä¿è¯ç”¨æˆ·ä½“éªŒå’Œæ–¹ä¾¿ä»£ç æ’é”™"><a href="#ğŸ“-ä¸ä»…è¦è€ƒè™‘-æˆåŠŸä¹‹åæ•°æ®çš„å¤„ç†-æ›´å¥½è€ƒè™‘-å‡ºé”™è¯¯çš„æ—¶å€™çš„é”™è¯¯å¤„ç†-ä¿è¯ç”¨æˆ·ä½“éªŒå’Œæ–¹ä¾¿ä»£ç æ’é”™" class="header-anchor">#</a> ğŸ“ ä¸ä»…è¦è€ƒè™‘ æˆåŠŸä¹‹åæ•°æ®çš„å¤„ç† æ›´å¥½è€ƒè™‘ å‡ºé”™è¯¯çš„æ—¶å€™çš„é”™è¯¯å¤„ç† ä¿è¯ç”¨æˆ·ä½“éªŒå’Œæ–¹ä¾¿ä»£ç æ’é”™</h3> <h3 id="await-çš„é”™è¯¯å¤„ç†"><a href="#await-çš„é”™è¯¯å¤„ç†" class="header-anchor">#</a> <code>await</code> çš„é”™è¯¯å¤„ç†</h3> <ul><li><p>å•ä¸ªé”™è¯¯å¤„ç†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// await åé¢ä¸€èˆ¬æƒ…å†µä¸‹ ä¹Ÿè·Ÿçš„æ˜¯ä¸ª promise</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// åœ¨å¤–é¢è¿›è¡Œçš„ é”™è¯¯å¤„ç†</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span>æˆåŠŸçš„å¤„ç†<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥å¯¹ await æ¥æ”¶åˆ°çš„é”™è¯¯ è¿›è¡Œå¤„ç†çš„</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// åœ¨å†…éƒ¨è¿›è¡Œçš„ é”™è¯¯å¤„ç† try catch</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// tryé‡Œé¢çš„ä»£ç æŠ¥é”™çš„æ—¶å€™,catché‡Œé¢çš„ä»£ç æ‰ä¼šæ‰§è¡Œ,finallyé‡Œé¢çš„ä»£ç æ°¸è¿œä¼šæ‰§è¡Œ</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'111'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœä¸Šé¢çš„å¼‚æ­¥é”™è¯¯äº† è¿™é‡Œæ˜¯æ‰“å°ä¸åˆ°çš„ å› ä¸ºä¼šé˜»æ–­</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯ä»¥åœ¨è¿™å—è¿›è¡Œé”™è¯¯å¤„ç†</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span> <span class="token comment">// æ— è®ºæœ‰æ— å¼‚å¸¸é‡Œé¢ä»£ç éƒ½ä¼šæ‰§è¡Œ</span>
    <span class="token comment">// ...è¿™é‡Œæ˜¯ try catch ä¹‹å éƒ½ä¼šè°ƒç”¨ä»£ç   ä¹Ÿå¯ä»¥å†™åœ¨è¿™é‡Œ</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// âš ï¸ å¦‚æœ å¤„ç†å®Œé”™è¯¯äº†ä¹‹å</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'222'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨è¿™é‡Œæ˜¯ å°±å¯ä»¥æ‰“å°åˆ°äº†</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>å¦‚æœæ˜¯ å¤šä¸ªå¼‚æ­¥ çš„æƒ…å†µä¸‹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æŠŠå¤šä¸ª ç»Ÿä¸€æ”¾ç½®åˆ° try catch é‡Œé¢</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> user1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™é‡Œ æ— è®ºè°å‘ç”Ÿé”™è¯¯ catch éƒ½ä¼šæ¥æ”¶åˆ°</span>
<span class="token punctuation">}</span>
<span class="token comment">// ä¹Ÿå¯ä»¥éƒ½æ”¾åœ¨ å¤–é¢è¿›è¡Œå¤„ç†</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™é‡Œä¹Ÿå¯ä»¥æ¥æ”¶åˆ° é‡Œé¢çš„é”™è¯¯</span>
  <span class="token comment">// ä½†æ˜¯ ä½ éœ€è¦è¿”å› await çš„æ•°æ® å› ä¸º... await æ˜¯ then çš„è¯­æ³•ç³– ç›¸å½“äº then æ“ä½œ</span>
  <span class="token comment">// ä¹‹å‰ promise.then å¦‚æœæœ‰é”™è¯¯ æœ€åç»Ÿä¸€å¤„ç†ä¹Ÿæ˜¯å¯ä»¥çš„</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <h2 id="ğŸ“ğŸŒğŸ‰await-å¹¶è¡Œæ‰§è¡Œçš„æŠ€å·§"><a href="#ğŸ“ğŸŒğŸ‰await-å¹¶è¡Œæ‰§è¡Œçš„æŠ€å·§" class="header-anchor">#</a> ğŸ“ğŸŒğŸ‰<code>await</code> å¹¶è¡Œæ‰§è¡Œçš„æŠ€å·§</h2> <ul><li><p>æ­£å¸¸æƒ…å†µä¸‹ <code>await</code> ä¸‹é¢ä»£ç éƒ½éœ€è¦ç­‰å¾… <code>await</code> è¿”å›ä¹‹åæ‰å¯ä»¥è¢«æ‰§è¡Œ</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// âš ï¸ p1 p2 éƒ½æ˜¯ å¼‚æ­¥</span>
  <span class="token comment">// let h1 = await p1;</span>
  <span class="token comment">// console.log(h1);</span>
  <span class="token comment">// let h2 = await p2;</span>
  <span class="token comment">// console.log(h2);</span>
  <span class="token comment">// // è¿™é‡Œè¿™æ ·å†™ å°±æ˜¯ ç­‰å¾…p1æ‰§è¡Œ ç„¶åp2æ‰§è¡Œ</span>

  <span class="token comment">// æ–¹æ³•1 - è¾¾åˆ°å¹¶è¡Œ - é™åˆ¶æ€§ æœ€åç­‰å¾…ç»“æœ ç„¶å å®ç°å¹¶è¡Œæ‰§è¡Œçš„æ•ˆæœ</span>
  <span class="token keyword">let</span> h1 <span class="token operator">=</span> p1<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> h2 <span class="token operator">=</span> p2<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// è¿™é‡Œå°±æ˜¯ p1 p2 æ˜¯åœ¨åŒæ—¶æ‰§è¡Œ åªä¸è¿‡æ˜¯æ¯”è¾ƒ è‡ªèº«æ‰§è¡Œå¿«æ…¢çš„é—®é¢˜</span>
  <span class="token comment">// ç„¶ååœ¨ä¸‹é¢æ‰§è¡Œ await å› ä¸ºä¸Šé¢å·²ç»åœ¨æ‰§è¡Œäº†</span>
  <span class="token keyword">let</span> h1Value <span class="token operator">=</span> <span class="token keyword">await</span> h1<span class="token punctuation">;</span> <span class="token comment">// await æ˜¯å½“ä½œ then æ¥æ‰§è¡Œçš„</span>
  <span class="token keyword">let</span> h2Value <span class="token operator">=</span> <span class="token keyword">await</span> h2<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h1Value<span class="token punctuation">,</span> h2Value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œå°±çœ‹åˆ° h1 h2 åŒæ—¶æ‰§è¡Œäº† amazing ğŸ˜± ç¥å¥‡</span>

  <span class="token comment">// æ–¹æ³•2 - Promise.all() = è¾¾åˆ°å¹¶è¡Œ</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œ ä¹Ÿå¯ä»¥åŒæ—¶æ¥æ”¶åˆ°ç»“æœ</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.26cac436.js" defer></script><script src="/assets/js/2.2df5d1b6.js" defer></script><script src="/assets/js/20.4bd18993.js" defer></script>
  </body>
</html>
